#####################################################################
#
#  Name:         Makefile
#  Created by:   Stefan Ritt
#
#  Contents:     Makefile for MIDAS example frontend and analyzer
#
#  Revision history
#  ------------------------------------------------------------------
#  date         by    modification
#  ---------    ---   -----------------------------------------------
#  05-SEP-97    SR    created
#
#####################################################################

#--------------------------------------------------------------------
# The following lines contain specific switches for different UNIX
# systems. Find the one which matches your OS and outcomment the 
# lines below.

#-------------------------------------------------------------------
# The following lines define direcories. Adjust if necessary
#                 
INC_DIR 	= /midas/include
DRV_DIR         = .
LIB_DIR 	= /usr/local/lib
CERNLIB_DIR	= /cern/pro/lib

#-----------------------
# Common flags
#
CC = cc
CFLAGS = -g -I$(INC_DIR)

#-----------------------
# OSF/1 (DEC UNIX)
#
ifeq ($(HOSTTYPE),alpha)
OSTYPE = osf1
endif

ifeq ($(OSTYPE),osf1)
OS_DIR = osf1
OSFLAGS = -DOS_OSF1 -DOS_UNIX
FFLAGS = -nofor_main -D 40000000 -T 20000000
LIBS = -lbsd
endif

#-----------------------
# Ultrix
#
ifeq ($(HOSTTYPE),mips)
OSTYPE = ultrix
endif

ifeq ($(OSTYPE),ultrix)
OS_DIR = ultrix
OSFLAGS = -DOS_ULTRIX -DOS_UNIX
LIBS =
endif

#-----------------------
# FreeBSD
#
ifeq ($(OSTYPE), FreeBSD)
OS_DIR = freeBSD
OSFLAGS = -DOS_FREEBSD -DOS_UNIX
LIBS = -lbsd -lcompat
endif

#-----------------------
# This is for Linux
#
ifeq ($(OSTYPE),Linux)
OSTYPE = linux
endif

ifeq ($(OSTYPE),linux)
OS_DIR = linux
OSFLAGS = -DOS_LINUX -DOS_UNIX
CFLAGS  = -O3
LDFLAGS = -DMODULE -D__KERNEL__
LIBS = -lbsd -lutil
endif

#-----------------------
# This is for Solaris
#
ifeq ($(OSTYPE),solaris)
CC = gcc
OS_DIR = solaris
OSFLAGS = -DOS_SOLARIS -DOS_UNIX
LIBS = -lsocket -lnsl
endif

#-------------------------------------------------------------------
# List of analyzer modules
#                 
MODULES 	= 

####################################################################
# Lines below here should not be edited
####################################################################
DRIVER = camacnul
LIB = $(LIB_DIR)/libmidas.a
INCLUDES = -I$(INC_DIR)

all: $(DRIVER).o $(UFE) 

$(UFE): $(LIB) $(LIB_DIR)/mfe.o $(DRIVER).o $(UFE).o
	$(CC) $(CFLAGS) $(OSFLAGS) $(INCLUDES) -c -o $(UFE).o $(UFE).c 
	$(CC) $(CFLAGS) -o $(UFE) $(UFE).o $(DRIVER).o $(LIB_DIR)/mfe.o \
	$(LIB) $(LDFLAGS) $(LIBS)

$(DRIVER).o: $(DRV_DIR)/$(DRIVER).c
	$(CC) $(CFLAGS) $(INCLUDES) $(OSFLAGS) -c -o $(DRIVER).o $(DRV_DIR)/$(DRIVER).c

.c.o:
	$(CC) $(CFLAGS) $(OSFLAGS) $(INCLUDES) -c $<

clean:
	rm -f *.o *~ \#*
